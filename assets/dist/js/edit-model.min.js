/*!
 * plugin-lib (https://github.com/felixarntz/plugin-lib)
 * By Felix Arntz (https://leaves-and-love.net)
 * Licensed under GPL-3.0
 */
!function(e,t){"use strict";function n(){if(!s){s=!0;var e={};e.nonce=t.generate_slug_nonce,e[t.primary_property]=t.primary_property_value;for(var n in u)e[u[n].propertyName]=u[n].$elem.val();wp.ajax.post(t.ajax_prefix+"model_generate_slug",e).done(function(e){e.verified&&e.verified.length&&(a=e.verified,c.val(a),r.text(a),"none"===o.css("display")&&o.fadeIn("slow")),s=!1}).fail(function(e){console.error(e),s=!1})}}function i(){if(!s){s=!0;var i=e("#edit-slug-buttons"),o=i.html(),p=r.html();i.html('<button type="button" class="save button button-small">'+t.i18n.ok+'</button> <button type="button" class="cancel button-link">'+t.i18n.cancel+"</button>"),i.children(".save").one("click",function(){var p=r.children("input").val();if(p==a)return void i.children(".cancel").trigger("click");var f={};f.nonce=t.verify_slug_nonce,f[t.primary_property]=t.primary_property_value,f[t.slug_property]=p,wp.ajax.post(t.ajax_prefix+"model_verify_slug",f).done(function(t){if(t.verified&&t.verified.length){if(a=t.verified,i.html(o),c.val(a),r.text(a),e(".edit-slug").focus(),!l){l=!0;for(var p in u)u[p].$elem.off("change",n)}s=!1}else i.children(".cancel").trigger("click")}).fail(function(e){console.error(e),i.children(".cancel").trigger("click")})}),i.children(".cancel").one("click",function(){i.html(o),c.val(a),r.html(p),s=!1}),r.html('<input type="text" id="new-post-slug" value="'+a+'" autocomplete="off" />').children("input").keydown(function(e){var t=e.which;13===t?(e.preventDefault(),i.children(".save").trigger("click")):27===t&&i.children(".cancel").trigger("click")}).keyup(function(){c.val(this.value)}).focus()}}e(".nav-tab").on("click",function(t){var n=e(this),i=n.parent().children(".nav-tab");t.preventDefault(),"true"!==n.attr("aria-selected")&&(i.each(function(){e(this).attr("aria-selected","false"),e(e(this).attr("href")).attr("aria-hidden","true")}),n.attr("aria-selected","true"),e(n.attr("href")).attr("aria-hidden","false").find(".plugin-lib-map-control").each(function(){e(this).wpMapPicker("refresh")}))});var r,a,l,c=e("#post_name"),o=e("#edit-slug-box"),u=[],s=!1;if(c.length&&o.length){if(r=e("#editable-post-name"),a=c.val(),l=!!a.length,!l&&t.slug_dependencies)for(var p in t.slug_dependencies){var f=e('[name="'+t.slug_dependencies[p]+'"]:input');f.length&&(u.push({propertyName:t.slug_dependencies[p],$elem:f}),f.on("change",n))}e("#titlediv").on("click",".edit-slug",function(){i()})}var d=e("#post-preview");d.length&&d.on("click",function(t){var n=e(this),i=e("#post_action"),r=e("form#post"),a=r.val(),l=r.attr("target")||"";t.preventDefault(),n.hasClass("disabled")||(i.val("preview"),r.attr("target","wp-preview").submit().attr("target",l),i.val(a))})}(jQuery,pluginLibEditModelData);