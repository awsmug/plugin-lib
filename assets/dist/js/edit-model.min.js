/*!
 * plugin-lib (https://github.com/felixarntz/plugin-lib)
 * By Felix Arntz (https://leaves-and-love.net)
 * Licensed under GPL-2.0-or-later
 */
!function(e,t){"use strict";function n(){window.onbeforeunload=function(){return!0}}function i(){if(!s){s=!0;var e={};e.nonce=t.generate_slug_nonce,e[t.primary_property]=t.primary_property_value;for(var n in p)e[p[n].propertyName]=p[n].$elem.val();wp.ajax.post(t.ajax_prefix+"model_generate_slug",e).done(function(e){e.verified&&e.verified.length&&(o=e.verified,c.val(o),r.text(o),"none"===u.css("display")&&u.fadeIn("slow")),s=!1}).fail(function(e){console.error(e),s=!1})}}function l(){if(!s){s=!0;var n=e("#edit-slug-buttons"),l=n.html(),u=r.html();n.html('<button type="button" class="save button button-small">'+t.i18n.ok+'</button> <button type="button" class="cancel button-link">'+t.i18n.cancel+"</button>"),n.children(".save").one("click",function(){var u=r.children("input").val();if(u==o)return void n.children(".cancel").trigger("click");var f={};f.nonce=t.verify_slug_nonce,f[t.primary_property]=t.primary_property_value,f[t.slug_property]=u,wp.ajax.post(t.ajax_prefix+"model_verify_slug",f).done(function(t){if(t.verified&&t.verified.length){if(o=t.verified,n.html(l),c.val(o),r.text(o),e(".edit-slug").focus(),!a){a=!0;for(var u in p)p[u].$elem.off("change",i)}s=!1}else n.children(".cancel").trigger("click")}).fail(function(e){console.error(e),n.children(".cancel").trigger("click")})}),n.children(".cancel").one("click",function(){n.html(l),c.val(o),r.html(u),s=!1}),r.html('<input type="text" id="new-post-slug" value="'+o+'" autocomplete="off" />').children("input").keydown(function(e){var t=e.which;13===t?(e.preventDefault(),n.children(".save").trigger("click")):27===t&&n.children(".cancel").trigger("click")}).keyup(function(){c.val(this.value)}).focus()}}e(".submitdelete").on("click",function(e){window.confirm(t.i18n.confirm_deletion)||e.preventDefault()}),e("#post").on("change",".plugin-lib-control",n),e("#post").on("keydown",'input[type="text"].plugin-lib-control',n),e("#post").on("keydown",'input[type="number"].plugin-lib-control',n),e("#post").on("keydown",'input[type="email"].plugin-lib-control',n),e("#post").on("click",'input[type="checkbox"]',n),e("#post").on("click",'input[type="radio"]',n),e("#post").on("submit",function(){window.onbeforeunload=null}),e(".nav-tab").on("click",function(t){var n,i,l,r=e(this),o=e(r.attr("href")),a=r.parent().children(".nav-tab");if(t.preventDefault(),"true"!==r.attr("aria-selected")){for(a.each(function(){e(this).attr("aria-selected","false"),e(e(this).attr("href")).attr("aria-hidden","true")}),r.attr("aria-selected","true"),o.attr("aria-hidden","false").find(".plugin-lib-map-control").each(function(){e(this).wpMapPicker("refresh")}),n=o.find("input,select,textarea,button,a,.select2-selection"),l=0;l<n.length&&(i=e(n.get(l)),"-1"===i.attr("tabindex"));l++)i=void 0;i&&i.focus()}});var r,o,a,c=e("#post_name"),u=e("#edit-slug-box"),p=[],s=!1;if(c.length&&u.length){if(r=e("#editable-post-name"),o=c.val(),a=!!o.length,!a&&t.slug_dependencies)for(var f in t.slug_dependencies){var d=e('[name="'+t.slug_dependencies[f]+'"]:input');d.length&&(p.push({propertyName:t.slug_dependencies[f],$elem:d}),d.on("change",i))}e("#titlediv").on("click",".edit-slug",function(){l()})}var v=e("#post-preview");v.length&&v.on("click",function(t){var n=e(this),i=e("#post_action"),l=e("form#post"),r=l.val(),o=l.attr("target")||"";t.preventDefault(),n.hasClass("disabled")||(i.val("preview"),l.attr("target","wp-preview").submit().attr("target",o),i.val(r))})}(jQuery,pluginLibEditModelData);