/*!
 * plugin-lib (https://github.com/felixarntz/plugin-lib)
 * By Felix Arntz (https://leaves-and-love.net)
 * Licensed under GPL-3.0
 */
!function(e,t,n,i,r,a){"use strict";function s(e){var t={};return n.each(e,function(e,i){n.isObject(e)&&!n.isArray(e)?(e=s(e),n.isEmpty(e)||(t[i]=e)):n.isString(e)&&e.match(/%([A-Za-z0-9]+)%/g)&&(t[i]=e)}),t}function l(e,t,i){function r(e,i){return n.isUndefined(t[i])?e:t[i]}n.isUndefined(i)&&(i=s(e)),n.each(i,function(i,a){n.isObject(i)?(n.isObject(e[a])||(e[a]={}),l(e[a],t,i)):e[a]=i.replace(/%([A-Za-z0-9]+)%/g,r)})}function d(e,t){var i=n.deepClone(e);return l(i,{index:t,indexPlus1:t+1}),i}function o(e,t,n){n||(n=0);for(var i=s(e),r=n;r<t.length;r++)l(t[r],{index:r,indexPlus1:r+1},i);return t}n.mixin({attrs:function(e){var t="";return n.each(e,function(e,i){n.isBoolean(e)?e&&(t+=" "+i):((n.isArray(e)||n.isObject(e))&&(e=window.JSON.stringify(e)),t+=n.isString(e)&&-1!==e.search('"')?" "+i+"='"+e+"'":" "+i+'="'+e+'"')}),t},deepClone:function(e){var t=n.clone(e);return n.each(t,function(e,i){n.isObject(e)&&(t[i]=n.deepClone(e))}),t}});var p={get_data_by_condition_bool_helper:function(e,t,n,i){var r,a,s,l,d,o=n.operator&&"OR"===n.operator.toUpperCase()?"OR":"AND";if(i?(r=n.result_true||!0,a=n.result_false||!1):(r=n.result_false||!1,a=n.result_true||!0),"OR"===o){for(d in Object.keys(t))if(l=Object.keys(t)[d],s=t[l])return a;return r}for(d in Object.keys(t))if(l=Object.keys(t)[d],s=t[l],!s)return r;return a},get_data_by_condition_numeric_comparison_helper:function(e,t,i,r){var a,s,l,d,o,p,u,c,h=i.operator&&"OR"===i.operator.toUpperCase()?"OR":"AND";if(r?(a=i.result_true||!0,s=i.result_false||!1):(a=i.result_false||!1,s=i.result_true||!0),l=0,d=parseFloat,n.isUndefined(i.breakpoint)||(parseInt(i.breakpoint,10)===i.breakpoint&&(d=n.bind(parseInt,void 0,void 0,10)),l=d(i.breakpoint)),o=!!i.inclusive,r&&(o=!o),"OR"===h){for(c in Object.keys(t))if(u=Object.keys(t)[c],p=d(t[u]),p>l||p===l&&o)return s;return a}for(c in Object.keys(t))if(u=Object.keys(t)[c],p=d(t[u]),p<l||p===l&&!o)return a;return s},merge_into_result:function(e,t,i){return n.isArray(e)&&n.isArray(t)?e="OR"===i?n.union(e,t):n.intersection(e,t):n.isObject(e)&&n.isObject(t)?e="OR"===i?n.extend(e,t):n.extend(n.pick(e,n.keys(t)),n.pick(t,n.keys(e))):n.isBoolean(e)&&n.isBoolean(t)?e="OR"===i?e||t:e&&t:t}},u={get_data_by_condition_true:function(e,t,n,i){var r=p.get_data_by_condition_bool_helper(e,t,n,!1);i(r)},get_data_by_condition_false:function(e,t,n,i){var r=p.get_data_by_condition_bool_helper(e,t,n,!0);i(r)},get_data_by_condition_greater_than:function(e,t,n,i){var r=p.get_data_by_condition_numeric_comparison_helper(e,t,n,!1);i(r)},get_data_by_condition_lower_than:function(e,t,n,i){var r=p.get_data_by_condition_numeric_comparison_helper(e,t,n,!0);i(r)},get_data_by_map:function(e,t,i,r){var a=i.default||null;if(n.isUndefined(i.map)||n.isEmpty(i.map))return void r(a);var s,l,d=i.map,o=!!i.merge,u=i.operator&&"OR"===i.operator.toUpperCase()?"OR":"AND",c=null,h=[];for(var g in Object.keys(t))s=Object.keys(t)[g],l=t[s],n.isUndefined(d[l])||(o&&!n.contains(h,l)?(h.push(l),c=p.merge_into_result(c,d[l],u)):(h.push(l),c=n.isObject(d[l])?n.clone(d[l]):d[l]));r(null===c?a:c)},get_data_by_named_map:function(e,t,i,r){var a=i.default||null;if(n.isUndefined(i.named_map)||n.isEmpty(i.named_map))return void r(a);var s,l,d,o=i.named_map,u=!!i.merge,c=i.operator&&"OR"===i.operator.toUpperCase()?"OR":"AND",h=null,g={};for(var f in Object.keys(t))s=Object.keys(t)[f],l=t[s],n.isUndefined(o[s])||(d=o[s],g[s]=[],n.isUndefined(d[l])||(u&&!n.contains(g[s],l)?(g[s].push(l),h=p.merge_into_result(h,d[l],c)):(g[s].push(l),h=n.isObject(d[l])?n.clone(d[l]):d[l])));r(null===h?a:h)}},c={},h={callbacks:{},queues:{},queueCount:0,queueTotal:0};c.DependencyResolver={startQueue:function(){h.queueCount++,h.queueTotal++;var e="queue"+h.queueTotal,t=new c.DependencyResolverQueue(e);return h.queues[e]=t,t},finishQueue:function(e){n.isUndefined(h.queues[e])||(delete h.queues[e],h.queueCount--)},addCallback:function(e,t){n.isFunction(t)&&(h.callbacks[e]=t)},getCallback:function(e){return h.callbacks[e]},loadCallbacks:function(){var e=Object.keys(u);for(var n in e)c.DependencyResolver.addCallback(e[n],u[e[n]]);t(document).trigger("pluginLibFieldsAPIDependencyCallbacks",c.DependencyResolver)}},c.DependencyResolverQueue=function(e){this.queueIdentifier=e,this.queuedItems=[],this.resolvedProps={},this.busyCount=0,this.finalizeCallback},n.extend(c.DependencyResolverQueue.prototype,{add:function(e,t,n,i,r){n=c.DependencyResolver.getCallback(n),n&&this.queuedItems.push({targetId:e,prop:t,callback:n,values:i,args:r})},resolve:function(e){var t;this.busyCount=this.queuedItems.length,this.finalizeCallback=e;for(var i in this.queuedItems)t=this.queuedItems[i],t.callback(t.prop,t.values,t.args,n.bind(this.resolved,this,t.targetId,t.prop))},resolved:function(e,t,i){null!==i&&(n.isUndefined(this.resolvedProps[e])&&(this.resolvedProps[e]={}),this.resolvedProps[e][t]=i),this.busyCount--,0===this.busyCount&&this.finalResolved()},finalResolved:function(){c.DependencyResolver.finishQueue(this.queueIdentifier),this.finalizeCallback(this.resolvedProps)}}),c.Field=i.Model.extend({sync:function(){return!1}}),c.FieldManager=i.Collection.extend({model:c.Field,initialize:function(e,t){t=t||{},t.instanceId&&(this.instanceId=t.InstanceId),this.dependencyTriggers={},this.on("update",this.updateDependencyTriggers,this),this.on("change:currentValue",this.triggerDependantsUpdate,this)},sync:function(){return!1},setupDependencyTriggers:function(){var e;for(var t in this.models)e=this.models[t],this.addFieldDependencies(e.get("id"),e.get("dependencies"))},updateDependencyTriggers:function(e,t){var n;for(var i in t.added)n=t.added[i],this.addFieldDependencies(n.get("id"),n.get("dependencies"));for(var r in t.removed)n=t.removed[r],this.removeFieldDependencies(n.get("id"))},triggerDependantsUpdate:function(e,t){var i=e.get("id");if(n.isArray(this.dependencyTriggers[i])){var r,a,s=new c.DependencyResolver.startQueue;for(var l in this.dependencyTriggers[i]){r=this.dependencyTriggers[i][l],a={};for(var d in r.fields)r.fields[d]===i?a[i]=t:a[r.fields[d]]=this.get(r.fields[d]).get("currentValue");s.add(r.targetId,r.prop,r.callback,a,r.args)}s.resolve(n.bind(this.updateDependants,this))}},updateDependants:function(e){n.each(e,n.bind(function(e,t){this.get(t).set(e)},this))},addFieldDependencies:function(e,t){n.isArray(t)&&n.each(t,n.bind(function(t){var i;for(var r in t.fields)i=t.fields[r],n.isUndefined(this.dependencyTriggers[i])&&(this.dependencyTriggers[i]=[]),this.dependencyTriggers[i].push({targetId:e,prop:t.prop,callback:t.callback,fields:t.fields,args:t.args})},this))},removeFieldDependencies:function(e){n.each(this.dependencyTriggers,n.bind(function(t,n){var i=[];for(var r in t)t[r].targetId!==e&&i.push(t[r]);i.length?this.dependencyTriggers[n]=i:delete this.dependencyTriggers[n]},this))}}),c.FieldView=i.View.extend({constructor:function(e){e=e||{};var t;if(e.model){t=e.model,e.el||(e.el="#"+t.get("id")+"-wrap"),e.labelTemplate||(e.labelTemplate="plugin-lib-field-"+t.get("slug")+"-label"),e.contentTemplate||(e.contentTemplate="plugin-lib-field-"+t.get("slug")+"-content"),e.repeatableItemTemplate||(e.repeatableItemTemplate="plugin-lib-field-"+t.get("slug")+"-repeatable-item");var a=t.get("dependencies");if(n.isArray(a)){var s;for(var l in a)s="apply"+("_"+a[l].prop).replace(/_([a-zA-Z0-9])/g,function(e,t){return t.toUpperCase()}),n.isFunction(this[s])&&t.on("change:"+a[l].prop,this[s],this)}this.events=this.getEvents(t)}e.labelTemplate&&(this.labelTemplate=r.template(e.labelTemplate)),e.contentTemplate&&(this.contentTemplate=r.template(e.contentTemplate)),e.repeatableItemTemplate&&(this.repeatableItemTemplate=r.template(e.repeatableItemTemplate)),this.preRender&&this.on("preRender",this.preRender,this),this.postRender&&this.on("postRender",this.postRender,this),i.View.apply(this,arguments)},initialize:function(){var e=this.$(".content-wrap");this.trigger("postRender",e)},renderLabel:function(){var e;this.labelTemplate&&(e=this.$("#"+this.model.get("id")+"-label-wrap"),e.replaceWith(this.labelTemplate(this.model.toJSON())))},renderContent:function(){var e;this.contentTemplate&&(e=this.$("#"+this.model.get("id")+"-content-wrap"),this.trigger("preRender",e),this.undelegateEvents(),e.replaceWith(this.contentTemplate(this.model.toJSON())),e=this.$("#"+this.model.get("id")+"-content-wrap"),this.delegateEvents(),this.trigger("postRender",e))},changeValue:function(e){this.model.set("currentValue",this.getInputValue(this.$(e.target)))},changeItemValue:function(e){var t=this.$(e.target),n=t.parents(".plugin-lib-repeatable-item"),i=n.parent().children().index(n),r=this.model.get("items");r[i]&&(r[i].currentValue=this.getInputValue(t)),this.model.set("items",r)},addItem:function(e){var n=this.model.get("repeatableLimit"),i=this.model.get("items");if(!(n>0&&i.length>=n)){var r=this.$(e.target),a=this.$(r.data("target")),s=a.children().length;r.prop("disabled",!0);var l=d(this.model.get("itemInitial"),s);i.push(l);var o=t(this.repeatableItemTemplate(l));a.append(o),this.trigger("postRender",o),this.model.set("items",i),n>0&&i.length>=n?r.hide():r.prop("disabled",!1)}},addItemOnEnter:function(e){if(13===e.which){var t=this.$(e.target).parents(".plugin-lib-repeatable-item");t.find(".plugin-lib-control").length>1||(e.preventDefault(),e.stopPropagation(),this.addItem({target:this.$(e.target).parents(".plugin-lib-repeatable-wrap").next(".plugin-lib-repeatable-add-button")[0]}),t.next().length&&t.next().find(".plugin-lib-control").focus())}},removeItem:function(e){var n=this,i=this.model.get("repeatableLimit"),r=this.model.get("items"),a=this.$(e.target),s=this.$(a.data("target")),l=s.parent(),d=l.children().index(s);a.prop("disabled",!0),r[d]&&(r.splice(d,1),n.trigger("preRender",s),s.remove(),d<r.length&&(r=o(this.model.get("itemInitial"),r,d),l.children().each(function(e){if(!(e<d)){var i=t(this),a=n.repeatableItemTemplate(r[e]);n.trigger("preRender",i),n.undelegateEvents(),i.replaceWith(a),n.delegateEvents(),n.trigger("postRender",a)}}))),this.model.set("items",r),i>0&&r.length<i&&t('button[data-target="#'+l.attr("id")+'"]').prop("disabled",!1).show()},remove:function(){return this.preRender&&this.off("preRender",this.preRender,this),this.postRender&&this.off("postRender",this.postRender,this),i.View.prototype.remove.apply(this,arguments)},getEvents:function(e){return e.get("repeatable")&&n.isArray(e.get("items"))?{"click .plugin-lib-repeatable-add-button":"addItem","keydown .plugin-lib-repeatable-item .plugin-lib-control":"addItemOnEnter","click .plugin-lib-repeatable-remove-button":"removeItem","change :input":"changeItemValue"}:{"change :input":"changeValue"}},getInputValue:function(e){var t=null;return e.is(":checkbox")&&"[]"===e.attr("name").substr(-2)?(t=[],e.parent().each(":checkbox:checked",n.bind(function(e,n){t.push(this.$(n).val())},this))):e.is(":radio")?t=e.parent().find(":radio:checked").val():e.is(":checkbox")?t=!!e.prop("checked"):e.is("select")&&e.prop("multiple")?(t=[],e.each("option:selected",n.bind(function(e,n){t.push(this.$(n).val())},this))):t=e.val(),t},applyLabel:function(e,t){var n=e.get("labelAttrs"),i=this.$(n.id?"#"+n.id:".plugin-lib-label:first");i.length?i.html(t):this.renderLabel()},applyDescription:function(e,t){var n=this.$("#"+e.get("id")+"-description");n.length?t.length?n.html(t):n.remove():t.length&&this.renderContent()},applyDisplay:function(e,t){var n=this.$el;t?(n.addClass("plugin-lib-toggling").removeClass("plugin-lib-hidden").attr("aria-hidden","false"),setTimeout(function(){n.removeClass("plugin-lib-toggling")},800)):(n.addClass("plugin-lib-toggling").addClass("plugin-lib-hidden").attr("aria-hidden","true"),setTimeout(function(){n.removeClass("plugin-lib-toggling")},800))},applyDefault:function(e,t){},applyChoices:function(e,t){this.renderContent()},applyOptgroups:function(e,t){this.renderContent()},applyUnit:function(e,t){var n=this.$(".plugin-lib-unit");n.length?t.length?n.html(t):n.remove():t.length&&this.$("#"+e.get("id")).after('<span class="plugin-lib-unit">'+t+"</span>")}}),c.FieldView.SelectFieldView=c.FieldView.extend({preRender:function(e){e.find("select.plugin-lib-control").select2("destroy")},postRender:function(e){e.find("select.plugin-lib-control").select2({width:"element",closeOnSelect:!0,minimumResultsForSearch:8})}}),c.FieldManager.instances={},t(document).ready(function(){c.DependencyResolver.loadCallbacks(),n.each(a.field_managers,function(e,t){c.FieldManager.instances[t]=new c.FieldManager(n.values(e.fields),{instanceId:t}),c.FieldManager.instances[t].setupDependencyTriggers(),n.each(c.FieldManager.instances[t].models,function(e){var t=e.get("backboneView"),n=c.FieldView;t&&"FieldView"!==t&&c.FieldView[t]&&(n=c.FieldView[t]),new n({model:e})})})}),e.pluginLibFieldsAPI=c}(window,jQuery,_,Backbone,wp,pluginLibFieldsAPIData);