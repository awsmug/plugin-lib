/*!
 * plugin-lib (https://github.com/felixarntz/plugin-lib)
 * By Felix Arntz (https://leaves-and-love.net)
 * Licensed under GPL-3.0
 */
!function(e,t,i,n,a,l){"use strict";function r(e){var t={};return i.each(e,function(e,n){i.isObject(e)&&!i.isArray(e)?(e=r(e),i.isEmpty(e)||(t[n]=e)):i.isString(e)&&e.match(/%([A-Za-z0-9]+)%/g)&&(t[n]=e)}),t}function s(e,t,n){function a(e,n){return i.isUndefined(t[n])?e:t[n]}i.isUndefined(n)&&(n=r(e)),i.each(n,function(n,l){i.isObject(n)?(i.isObject(e[l])||(e[l]={}),s(e[l],t,n)):e[l]=n.replace(/%([A-Za-z0-9]+)%/g,a)})}function d(e,t){var n=i.deepClone(e);return s(n,{index:t,indexPlus1:t+1}),n}function o(e,t,i){i||(i=0);for(var n=r(e),a=i;a<t.length;a++)s(t[a],{index:a,indexPlus1:a+1},n);return t}i.mixin({attrs:function(e){var t="";return i.each(e,function(e,n){i.isBoolean(e)?e&&(t+=" "+n):t+=" "+n+'="'+e+'"'}),t},deepClone:function(e){var t=i.clone(e);return i.each(t,function(e,n){i.isObject(e)&&(t[n]=i.deepClone(e))}),t}});var p={};p.Field=n.Model.extend({sync:function(){return!1}}),p.FieldManager=n.Collection.extend({model:p.Field,initialize:function(e,t){t=t||{},t.instanceId&&(this.instanceId=t.InstanceId)}}),p.FieldView=n.View.extend({constructor:function(e){e=e||{};var t;e.model&&(t=e.model,e.el||(e.el="#"+t.get("id")+"-wrap"),e.labelTemplate||(e.labelTemplate="plugin-lib-field-"+t.get("slug")+"-label"),e.contentTemplate||(e.contentTemplate="plugin-lib-field-"+t.get("slug")+"-content"),e.repeatableItemTemplate||(e.repeatableItemTemplate="plugin-lib-field-"+t.get("slug")+"-repeatable-item"),this.events=this.getEvents(t)),e.labelTemplate&&(this.labelTemplate=a.template(e.labelTemplate)),e.contentTemplate&&(this.contentTemplate=a.template(e.contentTemplate)),e.repeatableItemTemplate&&(this.repeatableItemTemplate=a.template(e.repeatableItemTemplate)),this.preRender&&this.on("preRender",this.preRender,this),this.postRender&&this.on("postRender",this.postRender,this),n.View.apply(this,arguments)},initialize:function(){var e=this.$(".content-wrap");this.trigger("postRender",e)},render:function(){var e;return this.contentTemplate&&(e=this.$(".content-wrap"),this.trigger("preRender",e),this.undelegateEvents(),e.replace(this.contentTemplate(this.model.toJSON())),this.delegateEvents(),this.trigger("postRender",e)),this},changeValue:function(e){this.model.set("currentValue",this.getInputValue(this.$(e.target)))},changeItemValue:function(e){var t=this.$(e.target),i=t.parents(".plugin-lib-repeatable-item"),n=i.parent().index(i),a=this.model.get("items");a[n]&&(a[n].current_value=this.getInputValue(t)),this.model.set("items",a)},addItem:function(e){var i=this.model.get("repeatableLimit"),n=this.model.get("items");if(!(i>0&&n.length>=i)){var a=this.$(e.target),l=this.$(a.data("target")),r=l.children().length;a.prop("disabled",!0);var s=d(this.model.get("itemInitial"),r);n.push(s);var o=t(this.repeatableItemTemplate(s));this.trigger("preRender",o),this.undelegateEvents(),l.append(o),this.delegateEvents(),this.trigger("postRender",o),this.model.set("items",n),i>0&&n.length>=i?a.hide():a.prop("disabled",!1)}},removeItem:function(e){var i=this.model.get("repeatableLimit"),n=this.model.get("items"),a=this.$(e.target),l=this.$(a.data("target")),r=l.parent(),s=r.index(l);a.prop("disabled",!0),n[s]&&(n.splice(s,1),l.remove(),s<n.length&&(n=o(this.model.get("itemInitial"),n,s),r.children().each(function(e){if(!(e<s)){var i=t(this);this.trigger("preRender",i),this.undelegateEvents(),i.replace(this.repeatableItemTemplate(n[e])),this.delegateEvents(),this.trigger("postRender",i)}}))),this.model.set("items",n),i>0&&n.length<i&&t('button[data-target="#'+r.attr("id")+'"]').prop("disabled",!1).show()},remove:function(){return this.preRender&&this.off("preRender",this.preRender,this),this.postRender&&this.off("postRender",this.postRender,this),n.View.prototype.remove.apply(this,arguments)},getEvents:function(e){return e.get("repeatable")&&i.isArray(e.get("items"))?{"click .plugin-lib-repeatable-add-button":"addItem","click .plugin-lib-repeatable-remove-button":"removeItem","change :input":"changeItemValue"}:{"change :input":"changeValue"}},getInputValue:function(e){var t=null;return e.is(":checkbox")&&"[]"===e.attr("name").substr(-2)?(t=[],e.parent().each(":checkbox:checked",i.bind(function(e,i){t.push(this.$(i).val())},this))):e.is(":radio")?t=e.parent().find(":radio:checked").val():e.is(":checkbox")?t=!!e.prop("checked"):e.is("select")&&e.prop("multiple")?(t=[],e.each("option:selected",i.bind(function(e,i){t.push(this.$(i).val())},this))):t=e.val(),t}}),p.FieldManager.instances={},t(document).ready(function(){i.each(l.field_managers,function(e,t){p.FieldManager.instances[t]=new p.FieldManager(i.values(e.fields),{instanceId:t}),i.each(p.FieldManager.instances[t].models,function(e){var t=e.get("backboneView"),i=p.FieldView;t&&"FieldView"!==t&&p.FieldView[t]&&(i=p.FieldView[t]),new i({model:e})})})}),e.pluginLibFieldsAPI=p}(window,jQuery,_,Backbone,wp,pluginLibFieldsAPIData);