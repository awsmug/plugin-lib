/*!
 * plugin-lib (https://github.com/felixarntz/plugin-lib)
 * By Felix Arntz (https://leaves-and-love.net)
 * Licensed under GPL-3.0
 */
!function(e,t,i,n,r,a){"use strict";function s(e){var t={};return i.each(e,function(e,n){i.isObject(e)&&!i.isArray(e)?(e=s(e),i.isEmpty(e)||(t[n]=e)):i.isString(e)&&e.match(/%([A-Za-z0-9]+)%/g)&&(t[n]=e)}),t}function l(e,t,n){function r(e,n){return i.isUndefined(t[n])?e:t[n]}i.isUndefined(n)&&(n=s(e)),i.each(n,function(n,a){i.isObject(n)?(i.isObject(e[a])||(e[a]={}),l(e[a],t,n)):e[a]=n.replace(/%([A-Za-z0-9]+)%/g,r)})}function o(e,t){var n=i.deepClone(e);return l(n,{index:t,indexPlus1:t+1}),n}function d(e,t,i){i||(i=0);for(var n=s(e),r=i;r<t.length;r++)l(t[r],{index:r,indexPlus1:r+1},n);return t}i.mixin({attrs:function(e){var t="";return i.each(e,function(e,n){i.isBoolean(e)?e&&(t+=" "+n):((i.isArray(e)||i.isObject(e))&&(e=window.JSON.stringify(e)),t+=i.isString(e)&&-1!==e.search('"')?" "+n+"='"+e+"'":" "+n+'="'+e+'"')}),t},deepClone:function(e){var t=i.clone(e);return i.each(t,function(e,n){i.isObject(e)&&(t[n]=i.deepClone(e))}),t}});var p={get_data_by_condition_bool_helper:function(e,t,i,n){var r,a,s,l,o,d=i.operator&&"OR"===i.operator.toUpperCase()?"OR":"AND";if(n?(r=i.result_true||!0,a=i.result_false||!1):(r=i.result_false||!1,a=i.result_true||!0),"OR"===d){for(o in Object.keys(t))if(l=Object.keys(t)[o],s=t[l])return a;return r}for(o in Object.keys(t))if(l=Object.keys(t)[o],s=t[l],!s)return r;return a},get_data_by_condition_numeric_comparison_helper:function(e,t,n,r){var a,s,l,o,d,p,c,u,h=n.operator&&"OR"===n.operator.toUpperCase()?"OR":"AND";if(r?(a=n.result_true||!0,s=n.result_false||!1):(a=n.result_false||!1,s=n.result_true||!0),l=0,o=parseFloat,i.isUndefined(n.breakpoint)||(parseInt(n.breakpoint,10)===n.breakpoint&&(o=i.bind(parseInt,void 0,void 0,10)),l=o(n.breakpoint)),d=!!n.inclusive,r&&(d=!d),"OR"===h){for(u in Object.keys(t))if(c=Object.keys(t)[u],p=o(t[c]),p>l||p===l&&d)return s;return a}for(u in Object.keys(t))if(c=Object.keys(t)[u],p=o(t[c]),p<l||p===l&&!d)return a;return s},merge_into_result:function(e,t,n){return i.isArray(e)&&i.isArray(t)?e="OR"===n?i.union(e,t):i.intersection(e,t):i.isObject(e)&&i.isObject(t)?e="OR"===n?i.extend(e,t):i.extend(i.pick(e,i.keys(t)),i.pick(t,i.keys(e))):i.isBoolean(e)&&i.isBoolean(t)?e="OR"===n?e||t:e&&t:t}},c={get_data_by_condition_true:function(e,t,i,n){var r=p.get_data_by_condition_bool_helper(e,t,i,!1);n(r)},get_data_by_condition_false:function(e,t,i,n){var r=p.get_data_by_condition_bool_helper(e,t,i,!0);n(r)},get_data_by_condition_greater_than:function(e,t,i,n){var r=p.get_data_by_condition_numeric_comparison_helper(e,t,i,!1);n(r)},get_data_by_condition_lower_than:function(e,t,i,n){var r=p.get_data_by_condition_numeric_comparison_helper(e,t,i,!0);n(r)},get_data_by_map:function(e,t,n,r){var a=n.default||null;if(i.isUndefined(n.map)||i.isEmpty(n.map))return void r(a);var s,l,o=n.map,d=!!n.merge,c=n.operator&&"OR"===n.operator.toUpperCase()?"OR":"AND",u=null,h=[];for(var g in Object.keys(t))s=Object.keys(t)[g],l=t[s],i.isUndefined(o[l])||(d&&!i.contains(h,l)?(h.push(l),u=p.merge_into_result(u,o[l],c)):(h.push(l),u=i.isObject(o[l])?i.clone(o[l]):o[l]));r(null===u?a:u)},get_data_by_named_map:function(e,t,n,r){var a=n.default||null;if(i.isUndefined(n.named_map)||i.isEmpty(n.named_map))return void r(a);var s,l,o,d=n.named_map,c=!!n.merge,u=n.operator&&"OR"===n.operator.toUpperCase()?"OR":"AND",h=null,g={};for(var m in Object.keys(t))s=Object.keys(t)[m],l=t[s],i.isUndefined(d[s])||(o=d[s],g[s]=[],i.isUndefined(o[l])||(c&&!i.contains(g[s],l)?(g[s].push(l),h=p.merge_into_result(h,o[l],u)):(g[s].push(l),h=i.isObject(o[l])?i.clone(o[l]):o[l])));r(null===h?a:h)}},u={},h={callbacks:{},queues:{},queueCount:0,queueTotal:0};u.DependencyResolver={startQueue:function(){h.queueCount++,h.queueTotal++;var e="queue"+h.queueTotal,t=new u.DependencyResolverQueue(e);return h.queues[e]=t,t},finishQueue:function(e){i.isUndefined(h.queues[e])||(delete h.queues[e],h.queueCount--)},addCallback:function(e,t){i.isFunction(t)&&(h.callbacks[e]=t)},getCallback:function(e){return h.callbacks[e]},loadCallbacks:function(){var e=Object.keys(c);for(var i in e)u.DependencyResolver.addCallback(e[i],c[e[i]]);t(document).trigger("pluginLibFieldsAPIDependencyCallbacks",u.DependencyResolver)}},u.DependencyResolverQueue=function(e){this.queueIdentifier=e,this.queuedItems=[],this.resolvedProps={},this.busyCount=0,this.finalizeCallback},i.extend(u.DependencyResolverQueue.prototype,{add:function(e,t,i,n,r){i=u.DependencyResolver.getCallback(i),i&&this.queuedItems.push({targetId:e,prop:t,callback:i,values:n,args:r})},resolve:function(e){var t;this.busyCount=this.queuedItems.length,this.finalizeCallback=e;for(var n in this.queuedItems)t=this.queuedItems[n],t.callback(t.prop,t.values,t.args,i.bind(this.resolved,this,t.targetId,t.prop))},resolved:function(e,t,n){null!==n&&(i.isUndefined(this.resolvedProps[e])&&(this.resolvedProps[e]={}),this.resolvedProps[e][t]=n),this.busyCount--,0===this.busyCount&&this.finalResolved()},finalResolved:function(){u.DependencyResolver.finishQueue(this.queueIdentifier),this.finalizeCallback(this.resolvedProps)}}),u.Field=n.Model.extend({sync:function(){return!1}}),u.FieldManager=n.Collection.extend({model:u.Field,initialize:function(e,t){t=t||{},t.instanceId&&(this.instanceId=t.InstanceId),this.dependencyTriggers={},this.on("update",this.updateDependencyTriggers,this),this.on("change:currentValue",this.triggerDependantsUpdate,this)},sync:function(){return!1},setupDependencyTriggers:function(){var e;for(var t in this.models)e=this.models[t],this.addFieldDependencies(e.get("id"),e.get("dependencies"))},updateDependencyTriggers:function(e,t){var i;for(var n in t.added)i=t.added[n],this.addFieldDependencies(i.get("id"),i.get("dependencies"));for(var r in t.removed)i=t.removed[r],this.removeFieldDependencies(i.get("id"))},triggerDependantsUpdate:function(e,t){var n=e.get("id");if(i.isArray(this.dependencyTriggers[n])){var r,a,s=new u.DependencyResolver.startQueue;for(var l in this.dependencyTriggers[n]){r=this.dependencyTriggers[n][l],a={};for(var o in r.fields)r.fields[o]===n?a[n]=t:a[r.fields[o]]=this.get(r.fields[o]).get("currentValue");s.add(r.targetId,r.prop,r.callback,a,r.args)}s.resolve(i.bind(this.updateDependants,this))}},updateDependants:function(e){i.each(e,i.bind(function(e,t){this.get(t).set(e)},this))},addFieldDependencies:function(e,t){i.isArray(t)&&i.each(t,i.bind(function(t){var n;for(var r in t.fields)n=t.fields[r],i.isUndefined(this.dependencyTriggers[n])&&(this.dependencyTriggers[n]=[]),this.dependencyTriggers[n].push({targetId:e,prop:t.prop,callback:t.callback,fields:t.fields,args:t.args})},this))},removeFieldDependencies:function(e){i.each(this.dependencyTriggers,i.bind(function(t,i){var n=[];for(var r in t)t[r].targetId!==e&&n.push(t[r]);n.length?this.dependencyTriggers[i]=n:delete this.dependencyTriggers[i]},this))}}),u.FieldView=n.View.extend({constructor:function(e){e=e||{};var t;if(e.model){t=e.model,e.el||(e.el="#"+t.get("id")+"-wrap"),e.labelTemplate||(e.labelTemplate="plugin-lib-field-"+t.get("slug")+"-label"),e.contentTemplate||(e.contentTemplate="plugin-lib-field-"+t.get("slug")+"-content"),e.repeatableItemTemplate||(e.repeatableItemTemplate="plugin-lib-field-"+t.get("slug")+"-repeatable-item");var a=t.get("dependencies");if(i.isArray(a)){var s;for(var l in a)s="apply"+("_"+a[l].prop).replace(/_([a-zA-Z0-9])/g,function(e,t){return t.toUpperCase()}),i.isFunction(this[s])&&t.on("change:"+a[l].prop,this[s],this)}this.events=this.getEvents(t)}e.labelTemplate&&(this.labelTemplate=r.template(e.labelTemplate)),e.contentTemplate&&(this.contentTemplate=r.template(e.contentTemplate)),e.repeatableItemTemplate&&(this.repeatableItemTemplate=r.template(e.repeatableItemTemplate)),this.preRender&&this.on("preRender",this.preRender,this),this.postRender&&this.on("postRender",this.postRender,this),n.View.apply(this,arguments)},initialize:function(){var e=this.$(".content-wrap");this.trigger("postRender",e)},renderLabel:function(){var e;this.labelTemplate&&(e=this.$("#"+this.model.get("id")+"-label-wrap"),e.replaceWith(this.labelTemplate(this.model.toJSON())))},renderContent:function(){var e;this.contentTemplate&&(e=this.$("#"+this.model.get("id")+"-content-wrap"),this.trigger("preRender",e),this.undelegateEvents(),e.replaceWith(this.contentTemplate(this.model.toJSON())),e=this.$("#"+this.model.get("id")+"-content-wrap"),this.delegateEvents(),this.trigger("postRender",e))},changeValue:function(e){this.model.set("currentValue",this.getInputValue(this.$(e.target)))},changeItemValue:function(e){var t=this.$(e.target),i=t.parents(".plugin-lib-repeatable-item"),n=i.parent().children().index(i),r=this.model.get("items");r[n]&&(r[n].currentValue=this.getInputValue(t)),this.model.set("items",r)},addItem:function(e){var i=this.model.get("repeatableLimit"),n=this.model.get("items");if(!(i>0&&n.length>=i)){var r=this.$(e.target),a=this.$(r.data("target")),s=a.children().length;r.prop("disabled",!0);var l=o(this.model.get("itemInitial"),s);n.push(l);var d=t(this.repeatableItemTemplate(l));a.append(d),this.trigger("postRender",d),this.model.set("items",n),i>0&&n.length>=i?r.hide():r.prop("disabled",!1)}},addItemOnEnter:function(e){if(13===e.which){var t=this.$(e.target).parents(".plugin-lib-repeatable-item");t.find(".plugin-lib-control").length>1||(e.preventDefault(),e.stopPropagation(),this.addItem({target:this.$(e.target).parents(".plugin-lib-repeatable-wrap").next(".plugin-lib-repeatable-add-button")[0]}),t.next().length&&t.next().find(".plugin-lib-control").focus())}},removeItem:function(e){var i=this,n=this.model.get("repeatableLimit"),r=this.model.get("items"),a=this.$(e.target),s=this.$(a.data("target")),l=s.parent(),o=l.children().index(s);a.prop("disabled",!0),r[o]&&(r.splice(o,1),i.trigger("preRender",s),s.remove(),o<r.length&&(r=d(this.model.get("itemInitial"),r,o),l.children().each(function(e){if(!(e<o)){var n=t(this),a=i.repeatableItemTemplate(r[e]);i.trigger("preRender",n),i.undelegateEvents(),n.replaceWith(a),i.delegateEvents(),i.trigger("postRender",a)}}))),this.model.set("items",r),n>0&&r.length<n&&t('button[data-target="#'+l.attr("id")+'"]').prop("disabled",!1).show()},remove:function(){return this.preRender&&this.off("preRender",this.preRender,this),this.postRender&&this.off("postRender",this.postRender,this),n.View.prototype.remove.apply(this,arguments)},getEvents:function(e){return e.get("repeatable")&&i.isArray(e.get("items"))?{"click .plugin-lib-repeatable-add-button":"addItem","keydown .plugin-lib-repeatable-item .plugin-lib-control":"addItemOnEnter","click .plugin-lib-repeatable-remove-button":"removeItem","change :input":"changeItemValue"}:{"change :input":"changeValue"}},getInputValue:function(e){var t=null;return e.is(":checkbox")&&"[]"===e.attr("name").substr(-2)?(t=[],e.parent().each(":checkbox:checked",i.bind(function(e,i){t.push(this.$(i).val())},this))):e.is(":radio")?t=e.parent().find(":radio:checked").val():e.is(":checkbox")?t=!!e.prop("checked"):e.is("select")&&e.prop("multiple")?(t=[],e.each("option:selected",i.bind(function(e,i){t.push(this.$(i).val())},this))):t=e.val(),t},applyLabel:function(e,t){var i=e.get("labelAttrs"),n=this.$(i.id?"#"+i.id:".plugin-lib-label:first");n.length?n.html(t):this.renderLabel()},applyDescription:function(e,t){var i=this.$("#"+e.get("id")+"-description");i.length?t.length?i.html(t):i.remove():t.length&&this.renderContent()},applyDisplay:function(e,t){var i=this.$el;t?(i.addClass("plugin-lib-toggling").removeClass("plugin-lib-hidden").attr("aria-hidden","false"),setTimeout(function(){i.removeClass("plugin-lib-toggling")},800)):(i.addClass("plugin-lib-toggling").addClass("plugin-lib-hidden").attr("aria-hidden","true"),setTimeout(function(){i.removeClass("plugin-lib-toggling")},800))},applyDefault:function(e,t){},applyChoices:function(e,t){this.renderContent()},applyOptgroups:function(e,t){this.renderContent()},applyUnit:function(e,t){var i=this.$(".plugin-lib-unit");i.length?t.length?i.html(t):i.remove():t.length&&this.$("#"+e.get("id")).after('<span class="plugin-lib-unit">'+t+"</span>")}}),u.FieldView.WYSIWYGFieldView=u.FieldView.extend({preRender:function(e){var t=e.find(".plugin-lib-control").attr("id"),i=tinymce.get(t);i&&(i.save(),i.remove(),delete window.tinyMCEPreInit.mceInit[t],delete window.tinyMCEPreInit.qtInit[t])},postRender:function(e){var t=e.find(".plugin-lib-control").attr("id");(i.isUndefined(window.tinyMCEPreInit.mceInit[t])||i.isUndefined(window.tinyMCEPreInit.qtInit[t]))&&(window.tinyMCEPreInit.mceInit[t]=this.model.get("tinyMCESettings"),window.tinyMCEPreInit.qtInit[t]=this.model.get("quickTagsSettings"),window.tinymce.init(window.tinyMCEPreInit.mceInit[t]),window.quicktags(window.tinyMCEPreInit.qtInit[t]))}}),u.FieldView.SelectFieldView=u.FieldView.extend({preRender:function(e){e.find("select.plugin-lib-control").select2("destroy")},postRender:function(e){e.find("select.plugin-lib-control").select2({width:"element",closeOnSelect:!0,minimumResultsForSearch:8})}});var g=!1;u.FieldView.DatetimeFieldView=u.FieldView.extend({constructor:function(){g||(t.datetimepicker.setLocale(a.language),g=!0),u.FieldView.apply(this,arguments)},preRender:function(e){e.find(".plugin-lib-control").datetimepicker("destroy")},postRender:function(e){var t={formatDate:"Y-m-d",formatTime:"H:i",dayOfWeekStart:a.startOfWeek,scrollMonth:!1,scrollTime:!1,scrollInput:!1,validateOnBlur:!1};switch(e.find(".plugin-lib-control").data("store")){case"time":t.format=a.timeFormat,t.datepicker=!1,t.onShow=this._timeOnShow;break;case"date":t.format=a.dateFormat,t.timepicker=!1,t.onShow=this._dateOnShow;break;default:t.format=a.datetimeFormat,t.onShow=this._datetimeOnShow}e.find(".plugin-lib-control").datetimepicker(t)},_datetimeOnShow:function(e,t){var i="";t.attr("min")&&(i=t.attr("min").split(" "),2===i.length?this.setOptions({minDate:i[0],minTime:i[1]}):1===i.length&&this.setOptions({minDate:i[0]})),t.attr("max")&&(i=t.attr("max").split(" "),2===i.length?this.setOptions({maxDate:i[0],maxTime:i[1]}):1===i.length&&this.setOptions({maxDate:i[0]})),t.attr("step")&&this.setOptions({step:parseInt(t.attr("step"),10)})},_dateOnShow:function(e,t){t.attr("min")&&this.setOptions({minDate:t.attr("min")}),t.attr("max")&&this.setOptions({maxDate:t.attr("max")})},_timeOnShow:function(e,t){t.attr("min")&&this.setOptions({minTime:t.attr("min")}),t.attr("max")&&this.setOptions({maxTime:t.attr("max")}),t.attr("step")&&this.setOptions({step:parseInt(t.attr("step"),10)})}}),u.FieldView.ColorFieldView=u.FieldView.extend({preRender:function(e){e.find(".plugin-lib-control").wpColorPicker("destroy")},postRender:function(e){e.find(".plugin-lib-control").wpColorPicker({mode:"hsv"})}}),u.FieldView.MediaFieldView=u.FieldView.extend({preRender:function(e){e.find(".plugin-lib-control").wpMediaPicker("destroy")},postRender:function(e){e.find(".plugin-lib-control").wpMediaPicker({filterable:!1,label_add:a.i18nMediaAddButton,label_replace:a.i18nMediaReplaceButton,label_remove:a.i18nMediaRemoveButton,label_modal:a.i18nMediaModalHeading,label_button:a.i18nMediaModalButton})}}),u.FieldView.MapFieldView=u.FieldView.extend({preRender:function(e){e.find(".plugin-lib-control").wpMapPicker("destroy")},postRender:function(e){e.find(".plugin-lib-control").wpMapPicker()}}),u.FieldManager.instances={},t(document).ready(function(){u.DependencyResolver.loadCallbacks(),i.each(a.field_managers,function(e,t){u.FieldManager.instances[t]=new u.FieldManager(i.values(e.fields),{instanceId:t}),u.FieldManager.instances[t].setupDependencyTriggers(),i.each(u.FieldManager.instances[t].models,function(e){var t=e.get("backboneView"),i=u.FieldView;t&&"FieldView"!==t&&u.FieldView[t]&&(i=u.FieldView[t]),new i({model:e})})})}),e.pluginLibFieldsAPI=u}(window,jQuery,_,Backbone,wp,pluginLibFieldsAPIData);